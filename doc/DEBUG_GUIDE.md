# –ü–æ—Å—ñ–±–Ω–∏–∫ –∑ –≤—ñ–¥–ª–∞–¥–∫–∏ MCP —Å–µ—Ä–≤–µ—Ä–∞

## üÜï –ü—Ä–æ–±–ª–µ–º–∏ –∑ –≤—ñ–¥–¥–∞–ª–µ–Ω–∏–º–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è–º–∏

### MCP error -32000: Connection closed

**–°–∏–º–ø—Ç–æ–º–∏**: –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ –¥–æ MCP —Å–µ—Ä–≤–µ—Ä–∞ –∑ —ñ–Ω—à–æ—ó –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó

**–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–æ–±–ª–µ–º–∏ –∑ –≤—ñ–¥–Ω–æ—Å–Ω–∏–º–∏ —à–ª—è—Ö–∞–º–∏ –¥–ª—è —ñ–º–ø–æ—Ä—Ç—ñ–≤ —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤

**–†—ñ—à–µ–Ω–Ω—è**:
1. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ø–æ–≤–Ω–∏–π —à–ª—è—Ö –¥–æ —Å–µ—Ä–≤–µ—Ä–∞:**
   ```bash
   python /–ø–æ–≤–Ω–∏–π/—à–ª—è—Ö/–¥–æ/mcp-adt/mcp_server.py
   ```

2. **–ó–∞–ø—É—Å—Ç—ñ—Ç—å —Ç–µ—Å—Ç –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è:**
   ```bash
   python /—à–ª—è—Ö/–¥–æ/mcp-adt/test_remote_connection.py
   ```

3. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é MCP –∫–ª—ñ—î–Ω—Ç–∞:**
   ```json
   {
     "mcpServers": {
       "adt-server": {
         "command": "python",
         "args": ["/–ø–æ–≤–Ω–∏–π/—à–ª—è—Ö/–¥–æ/mcp-adt/mcp_server.py"]
       }
     }
   }
   ```

4. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –ø—Ä–æ–µ–∫—Ç—É:** `mcp_server.log`

**–î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è**: [REMOTE_CONNECTION_GUIDE.md](REMOTE_CONNECTION_GUIDE.md)

## –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### 1. –í—ñ–¥–ª–∞–¥–∫–∞ —á–µ—Ä–µ–∑ VSCode
1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –ø—Ä–æ–µ–∫—Ç —É VSCode
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ –ø–∞–Ω–µ–ª—ñ "Run and Debug" (Ctrl+Shift+D)
3. –í–∏–±–µ—Ä—ñ—Ç—å –æ–¥–Ω—É –∑ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π:
   - **Debug MCP Server (HTTP)** - –æ—Å–Ω–æ–≤–Ω–∏–π —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ HTTP
   - **Debug MCP Server (STDIO)** - –æ—Å–Ω–æ–≤–Ω–∏–π —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ STDIO
   - **Debug Fixed MCP Server** - —Å–µ—Ä–≤–µ—Ä –∑ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–º–∏ —ñ–º–ø–æ—Ä—Ç–∞–º–∏
   - **Debug Minimal MCP Server** - –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π —Å–µ—Ä–≤–µ—Ä
   - **Debug Server with Breakpoints** - –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º–∏ breakpoints

### 2. –í—ñ–¥–ª–∞–¥–∫–∞ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω–∏–π —Ä—è–¥–æ–∫
```bash
# –û—Å–Ω–æ–≤–Ω–∏–π —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ HTTP
python debug_run.py --server main --transport http

# –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π —Å–µ—Ä–≤–µ—Ä
python debug_run.py --server minimal --transport http

# –ó –¥–µ—Ç–∞–ª—å–Ω–∏–º –ª–æ–≥—É–≤–∞–Ω–Ω—è–º
python debug_run.py --server main --transport http --verbose

# –ó —ñ–Ω—à–∏–º environment —Ñ–∞–π–ª–æ–º
python debug_run.py --server main --env e19.env
```

## –î–æ—Å—Ç—É–ø–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∏

### 1. –û—Å–Ω–æ–≤–Ω–∏–π —Å–µ—Ä–≤–µ—Ä (`mcp_server.py`)
- –í—Å—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ (20+)
- –ü–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å
- **–ü—Ä–æ–±–ª–µ–º–∞**: –∑–∞–≤–∏—Å–∞—î –Ω–∞ `tools/list`

### 2. –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π —Å–µ—Ä–≤–µ—Ä (`mcp_server_minimal.py`)
- 4 –±–∞–∑–æ–≤–∏—Ö —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏
- –°–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥—ñ–∫–∞
- **–ü—Ä–æ–±–ª–µ–º–∞**: —Ç–∞–∫–æ–∂ –∑–∞–≤–∏—Å–∞—î –Ω–∞ `tools/list`

### 3. –§—ñ–∫—Å–æ–≤–∞–Ω–∏–π —Å–µ—Ä–≤–µ—Ä (`mcp_server_fixed.py`)
- Fallback —ñ–º–ø–æ—Ä—Ç–∏ (tools/ ‚Üí src/tools/)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —à–ª—è—Ö—ñ–≤
- **–ü—Ä–æ–±–ª–µ–º–∞**: –∑–∞–≤–∏—Å–∞–Ω–Ω—è –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è

### 4. –ë–∞–∑–æ–≤–∏–π —Å–µ—Ä–≤–µ—Ä (`mcp_server_basic.py`)
- –ë–µ–∑ FastMCP, –±–∞–∑–æ–≤–∞ MCP –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ø–æ–º–∏–ª–∫–∏ API

## –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏

### HTTP (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –¥–ª—è –≤—ñ–¥–ª–∞–¥–∫–∏)
```bash
python mcp_server.py --transport http --port 8000
```
- –õ–µ–≥—à–µ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —á–µ—Ä–µ–∑ curl/Postman
- –î–µ—Ç–∞–ª—å–Ω—ñ—à—ñ –ª–æ–≥–∏
- –ú–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ breakpoints

### STDIO (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π MCP)
```bash
python mcp_server.py --transport stdio
```
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –ø—Ä–æ—Ç–æ–∫–æ–ª MCP
- –°–∫–ª–∞–¥–Ω—ñ—à–µ –≤—ñ–¥–ª–∞–≥–æ–¥–∂—É–≤–∞—Ç–∏
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç —á–µ—Ä–µ–∑ curl (HTTP)
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä
python mcp_server.py --transport http

# –í —ñ–Ω—à–æ–º—É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ
curl -X POST http://localhost:8000/tools/list \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":1,"method":"tools/list"}'
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —Ç–µ—Å—Ç–∏
```bash
# –¢–µ—Å—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
python test/test_mcp_client.py

# –¢–µ—Å—Ç –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
python test/test_minimal_server.py

# –¢–µ—Å—Ç —Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
python test/test_fixed_server.py
```

## –õ–æ–≥—É–≤–∞–Ω–Ω—è

### –§–∞–π–ª–∏ –ª–æ–≥—ñ–≤
- `debug_server.log` - –¥–µ—Ç–∞–ª—å–Ω—ñ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
- VSCode Debug Console - —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –ª–æ–≥–∏

### –†—ñ–≤–Ω—ñ –ª–æ–≥—É–≤–∞–Ω–Ω—è
```python
import logging
logging.basicConfig(level=logging.DEBUG)  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è
logging.basicConfig(level=logging.INFO)   # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è
```

## –í—ñ–¥–æ–º—ñ –ø—Ä–æ–±–ª–µ–º–∏

### 1. –ó–∞–≤–∏—Å–∞–Ω–Ω—è tools/list
**–°–∏–º–ø—Ç–æ–º–∏**: –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è, —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î—Ç—å—Å—è, –∞–ª–µ –∑–∞–≤–∏—Å–∞—î –Ω–∞ –∑–∞–ø–∏—Ç—ñ `tools/list`

**–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–æ–±–ª–µ–º–∞ –≤ –±—ñ–±–ª—ñ–æ—Ç–µ—Ü—ñ FastMCP 1.9.1

**–û–±—Ö—ñ–¥–Ω—ñ —à–ª—è—Ö–∏**:
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ HTTP —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
- –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –±–∞–∑–æ–≤—É MCP –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É
- –û–Ω–æ–≤–∏—Ç–∏ FastMCP –¥–æ –Ω–æ–≤–æ—ó –≤–µ—Ä—Å—ñ—ó

### 2. –ü–æ–º–∏–ª–∫–∏ —ñ–º–ø–æ—Ä—Ç—ñ–≤
**–°–∏–º–ø—Ç–æ–º–∏**: `ModuleNotFoundError` –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É

**–†—ñ—à–µ–Ω–Ω—è**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `mcp_server_fixed.py` –∑ fallback —ñ–º–ø–æ—Ä—Ç–∞–º–∏

### 3. API –ø–æ–º–∏–ª–∫–∏
**–°–∏–º–ø—Ç–æ–º–∏**: `TypeError` –∑ `get_capabilities()` –∞–±–æ `InitializationOptions`

**–†—ñ—à–µ–Ω–Ω—è**: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤–µ—Ä—Å—ñ—ó MCP –±—ñ–±–ª—ñ–æ—Ç–µ–∫

## Environment —Ñ–∞–π–ª–∏

### .env (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
```bash
python mcp_server.py --env .env
```

### e19.env (SAP —Å–∏—Å—Ç–µ–º–∞ E19)
```bash
python mcp_server.py --env e19.env
```

### btp_02.env (BTP —Å–∏—Å—Ç–µ–º–∞)
```bash
python mcp_server.py --env btp_02.env
```

## –ö–æ—Ä–∏—Å–Ω—ñ –∫–æ–º–∞–Ω–¥–∏

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–µ—Ä—Å—ñ–π
```bash
pip show mcp
pip show fastmcp
python --version
```

### –û–Ω–æ–≤–ª–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫
```bash
pip install --upgrade mcp
pip install --upgrade fastmcp
```

### –û—á–∏—Å—Ç–∫–∞ –∫–µ—à—É Python
```bash
find . -name "*.pyc" -delete
find . -name "__pycache__" -type d -exec rm -rf {} +
```

## –ü–æ—Ä–∞–¥–∏ –∑ –≤—ñ–¥–ª–∞–¥–∫–∏

1. **–ü–æ—á–Ω—ñ—Ç—å –∑ HTTP —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É** - –ª–µ–≥—à–µ –≤—ñ–¥–ª–∞–≥–æ–¥–∂—É–≤–∞—Ç–∏
2. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π —Å–µ—Ä–≤–µ—Ä** - –º–µ–Ω—à–µ –∑–º—ñ–Ω–Ω–∏—Ö
3. **–£–≤—ñ–º–∫–Ω—ñ—Ç—å –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è** - `--verbose`
4. **–°—Ç–∞–≤—Ç–µ breakpoints** —É VSCode –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –º—ñ—Å—Ü—è—Ö
5. **–ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –ª–æ–≥–∏** –≤ `debug_server.log`

## –ö–æ–Ω—Ç–∞–∫—Ç–∏

–ü—Ä–∏ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—ñ –ø—Ä–æ–±–ª–µ–º:
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `debug_server.log`
2. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —Ç–µ—Å—Ç–∏
3. –°–ø—Ä–æ–±—É–π—Ç–µ —Ä—ñ–∑–Ω—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Å–µ—Ä–≤–µ—Ä—ñ–≤
4. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ VSCode debugger –∑ breakpoints
